DATA SEGMENT

DATA ENDS

STACKS SEGMENT

STACKS ENDS

CODES SEGMENT
ASSUME CS:CODES,DS:DATA,SS:STACKS
START:
CALL SET ;安装中断子程序
MOV AX,DATA
MOV DS,AX
INT 86H ;调用所安装的INT 86H
MOV DL,BL ;取得结果
ADD DL,30H
MOV AH,2
INT 21H
MOV AH,4CH
INT 21H

SET PROC NEAR
MOV AX,CS
MOV DS,AX
MOV SI,OFFSET INT86
MOV AX,0
MOV ES,AX
MOV DI,230H ;要注意86H向量放在218H~221H中，不要与之冲突
MOV CX,OFFSET INT86END-OFFSET INT86
CLD
REP MOVSB ;以上几步实现将中断程序存入230H
MOV AX,0
MOV ES,AX
MOV WORD PTR ES:[86H*4],230H
MOV WORD PTR ES:[86H*4+2],0 ;这两步设置中断向量
RET
SET ENDP

INT86:
PUSH CX
PUSH DX
PUSH AX ;保留寄存器中原始数据
REDO:STI ;置IF=1允许中断，以调用INT 1AH
MOV AH,0
INT 1AH ;取一个时钟滴答计数放入DX
MOV AX,DX
AND AX,0FH ;只保留低4位
MOV DL,0AH
DIV DL
CMP AH,0
JE REDO ;若余数为0则应重取，因要取1~9的随机数
MOV BL,AH ;所取随机数存入BL
POP AX
POP DX
POP CX ;恢复寄存器原数据
IRET ;恢复CS IP
INT86END:NOP

CODES ENDS
END START